<!DOCTYPE html>
<html>
<head>
  <title>Question 2</title>
  <script src="/src/vue.js"></script>
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.9/vue.min.js"></script> -->
</head>
<body>
  <div id="app">
      <div v-if="states.length > 0">
        <button @click="step--">Previous Step</button>
        <button @click="step++">Next Step</button>
        <button @click="play()">Play</button>
        <button @click="stopPlaying()">Stop</button>

        <div v-for="row in states[step]" class="row">
          <div v-for="t in row" v-bind:class="{'pacman': t.agent > 0, 'obsticle': t.obsticle && !t.pacman, 'tile': true, python: t.agent < 0, reward: t.reward > 0 && t.agent == 0}">
          </div>
        </div>
        <table>
          <tr><td>Step</td><td>{{step}}</td></tr>
          <tr><td>Score</td><td>{{scores[step]}}</td></tr>
        </table>
      </div>
      <button v-else @click="createGame()">NewGame</button>
  </div>
</body>
<script>
var app = new Vue({
  el: '#app',
  data() {
    return {
      states: [],
      step: 0,
      scores: [],
      stepper: null
    }
  },
  methods: {
    createGame: function () {
      const req = new XMLHttpRequest()
      const that = this
      req.onreadystatechange = function () {
        if (this.readyState == 4) {
          if (this.status >= 200 && this.status < 300) {
            var data = JSON.parse(req.responseText)
            console.log(data)
            that.scores = data.scores
            that.states = data.states
            that.step = 0
          }
        }
      }
      req.open("POST", "/api/level/01", true);
      req.send();
    },
    play: function () {
      if (this.stepper == null) {
        var that = this
        this.stepper = setInterval( function () {
          that.step = (that.step+1)%that.states.length
        }, 100)
      }
    },
    stopPlaying: function () {
      clearInterval(this.stepper)
      this.stepper = null
    },
  }
})
</script>
<style>
body, html {background: black; color: white}
#app{margin: 10vh auto; width: 512px; height: 512px}
.tile {width: 24px; height: 24px; margin: 4px; padding: 0px; float: left}
.obsticle { background: white; width: 20px; height: 20px; margin: 6px}
.row {height: 32px; width: 100vw}
.python {
  width: 24px;
  height: 24px;
  /*border-radius: 6px;*/
  margin: 4px;
  background-image: url("/src/python.png");
  background-size: 24px 24px;
}
.pacman {
  width: 24px;
  height: 24px;
  /*border-radius: 6px;*/
  margin: 4px;
  /*background: HSL(40, 90%, 69%);*/
  background-image: url("/src/gopher.png");
  background-size: 24px 24px;
}
.reward {border-radius: 6px; width: 12px; height: 12px; margin: 10px; background: HSL(173, 38%, 68%)}
</style>
</html>
